[[toc]]

# 智控台灯 编程实现

> 案例:
>
> 1 按钮控制台灯 
>
> 2 光控台灯
>
> 3 语音识别控制台灯



## 1 按钮控制台灯

**功能：按钮按下时，灯盘点亮；松开时，灯盘熄灭。**

<a href="/tutorial/cfdsx/sb3/01/按钮控制台灯.sb3">点击下载程序: 按钮控制台灯.sb3</a>

<a href="https://www.bilibili.com/video/BV1yVyHYSEgM/?spm_id_from=333.999.0.0&vd_source=d34a80bae9d64a0c5a0716bd47877802" target="_blank">点击观看视频教学</a>

按钮按下状态，返回数值1；松开状态，返回数值0。

灯盘高电平状态，点亮；低电平状态，熄灭。

![image-20240925194657382](/智控台灯编程实现.assets/image-20240925194657382.png)



## 2 光控台灯

### 2.1 屏显光照强度

**功能：屏显光线检测模块实时监测到的模拟数值大小，可用于光照阈值的选取。**

<a href="/tutorial/cfdsx/sb3/01/屏显光照强度.sb3">点击下载程序: 屏显光照强度.sb3</a>

为更好地观察屏显信息，屏幕刷新频率不宜过快，固添加短暂延时。

![image-20240925194830951](/智控台灯编程实现.assets/image-20240925194830951.png)



### 2.2 光控亮灭

**功能：光线检测模块监测光照情况，环境较暗时，台灯点亮；反之，熄灭。**

<a href="/tutorial/cfdsx/sb3/01/光控亮灭.sb3">点击下载程序:  光控亮灭.sb3</a>

<a href="https://www.bilibili.com/video/BV1PVyHYSEHE/?spm_id_from=333.999.0.0&vd_source=d34a80bae9d64a0c5a0716bd47877802" target="_blank">点击观看视频教学</a>


这里数值“300”是区分环境亮暗的边界值，一般也被称为“阈值”；可以根据2.1程序选取合适的数值。

![image-20240925200250245](/智控台灯编程实现.assets/image-20240925200250245.png)



## 3 语音识别控制台灯

### 3.1 可识别词条ID

主控板板载语音识别模块。其中，固化内置了一系列能够被识别的常用语句词条。<a href="/tutorial/cfdsx/others/创趣开源大师兄语音识别词条ID.xlsx">点击下载可识别词条与ID对照表</a>

调用如下指令（传感器库），可获取词条对应的编号ID。

![image-20240925201149255](/智控台灯编程实现.assets/image-20240925201149255.png)

使用语音识别功能，交互时，需先说出唤醒词“你好，小宁” 或 “你好，小金” 或 “你好，大师兄”，成功唤醒后，每条指令间隔均应大于1.5秒小于10秒，此时不用重复唤醒。

譬如：“你好，大师兄”  -（等待2秒）-  “开灯” - （等待5秒） - “关灯”

我们可以利用屏显功能验证可识别词条的ID值：

![image-20240925203537951](/智控台灯编程实现.assets/image-20240925203537951.png)

① 语音识别未检测到有效词条时，返回数值0；屏幕仅在检测到有效词条之后，刷新屏幕，并显示对应ID值。



### 3.2 语音控制开关灯

<a href="/tutorial/cfdsx/sb3/01/语音控制开关灯.sb3">点击下载程序:  语音控制开关灯.sb3</a>

<a href="https://www.bilibili.com/video/BV1PVyHYSEGs/?spm_id_from=333.999.0.0&vd_source=d34a80bae9d64a0c5a0716bd47877802" target="_blank">点击观看视频教学</a>

![image-20240925204737779](/智控台灯编程实现.assets/image-20240925204737779.png)

子程序`提示灯`板载灯点亮1.5秒后熄灭，为增加交互者体验感，程序在识别到有效词条后调用`提示灯`；用户可根据板载灯状态判断指令是否被识别，再在板载灯熄灭后，发布新的指令。


### 3.3 语音控制开关灯（集成提示灯功能）

<a href="/tutorial/cfdsx/sb3/01/语音控制开关灯.sb3">点击下载程序:  语音控制开关灯（集成提示灯功能）.sb3</a>

![image-20240925204737779](/智控台灯编程实现.assets/Snipaste_2024-10-22_14-59-18.png)

`设置板载语音提示灯功能开启`其作用近似案例3.2编写的子程序`提示灯`。当语音识别传感器检测到有效指令时，板载灯会点亮约1.5秒后熄灭；用户可根据板载灯状态判断指令是否被识别，再在板载灯熄灭后，发布新的指令。

*注：该功能因使用板载灯会占用P15引脚；另外，集成提示灯功能开启后，板载指示灯由亮至灭的过程会引起程序的阻塞，故效果呈现上存在滞后性。*

*例如：以上程序在运行时，当用户说出‘你好，小宁’成功唤醒主控，待指示灯由亮至灭后；再说出‘开灯’指令，**会观察到指示灯由亮至灭后，台灯的灯盘才点亮***